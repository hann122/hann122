1. FIM

NOT syscheck.path: *driverstore* AND NOT syscheck.path: *Winlogon* AND NOT syscheck.path: *\\windows\\system32*  AND NOT syscheck.path: *\\windows\\syswow64*

2. ELK

message : *whoami* or message : *blood* or message : *peas* or message : *adexplorer* or message : *impacket*
event.code : 11 -> File created
event.code : 1  -> Process create
event.code : 3  --> Network connection detected



Network connection detected:
RuleName: -
UtcTime: 2025-09-09 07:28:59.193
ProcessGuid: {fe58802f-d73b-68bf-9701-000000000e00}
ProcessId: 3404
Image: C:\Windows\Temp\agent.exe
User: IIS APPPOOL\DefaultAppPool
Protocol: tcp
Initiated: true
SourceIsIpv6: false
SourceIp: 10.0.2.15
SourceHostname: castelblack.north.sevenkingdoms.local
SourcePort: 50159
SourcePortName: -
DestinationIsIpv6: false
DestinationIp: 10.8.0.9
DestinationHostname: -
DestinationPort: 11601
DestinationPortName: -

3. Hunting
https://0xmedhat.gitbook.io/whoami/hunting-with-elk
- Well-known tools
winlog.event_data.ScriptBlockText:(PowerUp OR Mimikatz OR NinjaCopy OR Get-ModifiablePath OR AllChecks OR AmsiBypass OR PsUACme OR Invoke-DLLInjection OR Invoke-ReflectivePEInjection OR Invoke-Shellcode OR Get-GPPPassword OR Get-Keystrokes OR Get-TimedScreenshot OR PowerView)
- 
winlog.event_data.ParentImage:(*mshta.exe OR *rundll32.exe OR *regsvr32.exe OR *services.exe OR *winword.exe OR *wmiprvse.exe OR *powerpnt.exe OR *excel.exe OR *msaccess.exe OR *mpub.exe OR *visio.exe OR *outlook.exe OR *chrome.exe OR *iexplorer.exe OR *sqlserver.exe) AND winlog.event_data.Image : *powershell.exe
- Base64 hunting
(winlog.event_data.Description:*PowerShell OR  winlog.event_data.Image:*powershell.exe) AND winlog.event_data.CommandLine:*-e*
- Gzip 
winlog.event_data.ScriptBlockText:*H4sI*
- 
winlog.event_data.ScriptBlockText:(*bxor* AND *join*)
winlog.event_data.ScriptBlockText:((*Load*) AND (*ReadAllBytes* OR *LoadFile*))
- Download
winlog.event_data.ScriptBlockText:(*WebClient* OR *DownloadData* OR *DownloadFile* OR *DownloadString* OR *OpenRead* OR *WebRequest* OR *curl* OR *wget* OR *RestMethod* OR *WinHTTP* OR *InternetExplorer.Application* OR *Excel.Application* OR *Word.Application* OR *Msxml2.XMLHTTP* OR *MsXML2.ServerXML* OR *System.XML.XMLDocument* OR *BitsTransfer*)
- Obfucasted
winlog.event_data.ScriptBlockText:((*char* AND *join*) OR ((*ToInt* OR *ToInt16* OR *ToDecimal* OR *ToByte* OR *ToUnit* OR *ToSingle*) AND (*ToChar* OR *ToString* OR *String*)) OR (*ForEach* AND *Xor*))
winlog.event_data.ScriptBlockText:(*hctac* OR *kearb* OR *dnammoc* OR *ekovn* OR *elifd* OR *rahc* OR *etirw* OR *eddih* OR *tpircs* OR *ssecorp* OR *llehsrewop* OR *esnopser* OR *daolnwod* OR *tneilcbew* OR *tneilc* OR *ptth* OR *elifotevas* OR *46esab* OR *tcejbo* OR *maerts* OR *hcaerof* OR *retupmoc*)
--------
- Rundll32
process.name:rundll32.exe AND (process.args:pcwutl.dll AND process.args:LaunchApplication)
- UAC bypass
event.id:7 AND (process.name:cliconfg.exe AND file.path:NTWDBLIB.dll)
event.id:13 AND registry_key_path:"shell\\runas\\command\\isolatedCommand"

- RDP Settings tampering
event.id:1 AND (process.name:netsh.exe AND (process.args:localport=3389 AND process.args:action=allow))
- DC Sync
event.id:4662 AND NOT (user.name:*$ OR user.name:AUTHORITY OR user.name:Window) AND (object.properties:1131f6ad-9c07-11d1-f79f-00c04fc2dcd2 OR object.properties:Replicating)
- Remote WMI Usage
event.id:4648 AND process.executable:WMIC.exe
- LOLBAS openurl
process.executable:rundll32.exe AND process.args:(url.dll OR ieframe.dll OR shdocvw.dll)
- Scheduled task
event.id:1 AND ((process.executable:schtasks.exe AND process.args:create) OR process.executable:at.exe)

- Account discovery
winlog.event_id:(4798 OR 4799) AND winlog.event_data.CallerProcessName:(net OR net1) AND winlog.computer_name: MSEDGEWIN10







